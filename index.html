<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waypoint Editor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <h1>Waypoint Editor</h1>
        <div class="mode-buttons">
            <button class="btn btn-secondary active" id="modePoint" onclick="setMode('point')">
                ポイント <span style="opacity: 0.6; font-size: 0.85em;">(1)</span>
            </button>
            <button class="btn btn-secondary" id="modeLine" onclick="setMode('line')">
                ライン <span style="opacity: 0.6; font-size: 0.85em;">(2)</span>
            </button>
            <button class="btn btn-secondary" id="modeSmartPath" onclick="setMode('smartPath')">
                経路計画 <span style="opacity: 0.6; font-size: 0.85em;">(3)</span>
            </button>
            <button class="btn btn-secondary" id="modeSelect" onclick="setMode('select')">
                選択 <span style="opacity: 0.6; font-size: 0.85em;">(4)</span>
            </button>
            <button class="btn btn-secondary" id="modePan" onclick="setMode('pan')">
                移動 <span style="opacity: 0.6; font-size: 0.85em;">(5)</span>
            </button>
        </div>
    </div>
    <div class="container">
        <div class="sidebar">
            <div class="section">
                <h2>マップ設定</h2>
                <label>PGMファイル</label>
                <input type="file" id="pgmFile" accept=".pgm,.png,.jpg">

                <label>YAMLファイル（オプション）</label>
                <input type="file" id="yamlFile" accept=".yaml,.yml">

                <label>解像度 (m/pixel)</label>
                <input type="number" id="resolution" value="0.05" step="0.001">

                <label>原点 X (m)</label>
                <input type="number" id="originX" value="-102" step="0.1">

                <label>原点 Y (m)</label>
                <input type="number" id="originY" value="-141" step="0.1">
            </div>

            <div class="section">
                <h2>操作方法</h2>
                <p class="help-text">
                    <strong>ポイント (1):</strong> クリックで追加<br>
                    <strong>ライン (2):</strong> ドラッグで描画<br>
                    <strong>経路計画 (3):</strong> 開始→終了点で自動生成<br>
                    <strong>選択 (4):</strong> ドラッグで移動<br>
                    &nbsp;&nbsp;ダブルクリック/Wで待機トグル<br>
                    &nbsp;&nbsp;Delete/Backspaceで削除<br>
                    <strong>移動 (5):</strong> ドラッグで画面移動
                </p>

                <label>ライン間隔 (m)</label>
                <input type="number" id="lineInterval" value="0.5" step="0.1" min="0.1">
            </div>

            <div class="section">
                <h2>ウェイポイント (<span id="waypointCount">0</span>)</h2>
                <div class="waypoint-list" id="waypointList">
                    <p style="color: #666; padding: 10px;">ウェイポイントがありません</p>
                </div>
                <button class="btn btn-danger" onclick="clearWaypoints()">すべて削除</button>
                <button class="btn btn-secondary" onclick="undoLast()">元に戻す</button>
            </div>

            <div class="section">
                <h2>エクスポート</h2>
                <button class="btn btn-primary" onclick="exportCSV()">CSV出力</button>
                <button class="btn btn-secondary" onclick="importCSV()">CSV読込</button>
                <input type="file" id="csvImport" accept=".csv" style="display: none;">

                <div class="info-box" style="margin-top: 10px;">
                    <strong>CSV形式:</strong><br>
                    <code>x,y,yaw,pause_sec</code><br>
                    x, y: 位置 (メートル)<br>
                    yaw: 向き (ラジアン)<br>
                    pause_sec:<br>
                    &nbsp; 0 = 待機なし<br>
                    &nbsp; -1 = トピック待機
                </div>
            </div>
        </div>

        <div class="canvas-container" id="canvasContainer">
            <canvas id="mapCanvas"></canvas>
            <div class="zoom-controls">
                <button onclick="zoomIn()">+</button>
                <button onclick="zoomOut()">-</button>
                <button onclick="resetView()">R</button>
            </div>
            <div class="status-bar">
                <span id="mouseCoords">Mouse: -</span>
                <span id="worldCoords">World: -</span>
                <span id="zoomLevel">Zoom: 100%</span>
            </div>
        </div>
    </div>

    <!-- JavaScript files in dependency order -->
    <script src="js/state.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/pathfinding.js"></script>
    <script src="js/renderer.js"></script>
    <script src="js/waypoints.js"></script>
    <script src="js/fileio.js"></script>
    <script src="js/events.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
